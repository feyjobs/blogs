# 工作内容
## goods老接口迁移
### 非万能接口
```PHP
./models/dao/api/dish/Dish.php:        $req['header']['pathinfo'] = 'goods/main/main/addshopdishlog';
./models/dao/api/shop/ShopBasic.php:        $req['header']['pathinfo'] = 'goods/main/main/addshoplog';
./models/dao/api/shop/ShopBasic.php:        $req['header']['pathinfo'] = 'goods/main/main/addshopoperatorlog';
./models/dao/api/shop/Supplier.php:        $req['header']['pathinfo'] = 'goods/main/main/addsupplierlog';
./models/dao/api/shop/AnnouncementLog.php:        $req['header']['pathinfo'] = 'goods/main/main/getlistbyconds';
./models/dao/api/shop/AnnouncementLog.php:        $req['header']['pathinfo'] = 'goods/main/main/insert';
./models/dao/api/shop/Base.php:        $req['header']['pathinfo'] = 'goods/main/main/deletebyconds';
./models/dao/api/shop/Base.php:        $req['header']['pathinfo'] = 'goods/main/main/updatebyconds';
./models/dao/api/shop/Base.php:        $req['header']['pathinfo'] = 'goods/main/main/insert';
```
#### addshopdishlog
业务不确定是否依然在使用,待确认
设计page 层
./models/service/page/commodity/Sku.php:class
涉及接口 Commodity

~~updateskubatchbysupplier~~

~~updateskupost~~

>pdo2 -bns group.wmcrm.iwaimai.all 'grep -E "updateskupost" /home/work/odp_wmcrm/log/access_log*|grep -vE "commodity/v1/updateskupost|commodity/updateskupost|commodity/na/updateskupostv1"'

~~disablesku~~
>pdo2 -bns group.wmcrm.iwaimai.all 'grep -E "disablesku" /home/work/odp_wmcrm/log/access_log*|grep -vE "commodity/disablesku|/commodity/na/disableskuv1|crmmobileui/commodity/v1/disablesku"'

~~skulist~~
>pdo2 -bns group.wmcrm.iwaimai.all 'grep -E "skulist" /home/work/odp_wmcrm/log/access_log*|grep -vE "notice|neworderlist|commodity/getskulistbyfrontcategory|commodity/na/getskulistbyfrontcategoryv1|getdishorskulist|crmmobileui/commodity/v1/getskulist|commodity/getskulist|commodity/skulist|commodity/getsupplierskulist|commodity/na/getskulistv1|static"'

~~getskutemplate~~
>pdo2 -bns group.wmcrm.iwaimai.all 'grep -E "getskutemplate" /home/work/odp_wmcrm/log/access_log*'

~~addskupost~~
>pdo2 -bns group.wmcrm.iwaimai.all 'grep -E "addskupost" /home/work/odp_wmcrm/log/access_log*|grep -vE "commodity/na/addskupostv1|commodity/addskupost|crmmobileui/commodity/v1/addskupost"'

~~getsugsku~~
>pdo2 -bns group.wmcrm.iwaimai.all 'grep -E "getsugsku" /home/work/odp_wmcrm/log/access_log*|grep -vE "commodity/na/getsugskuv1|crmmobileui/commodity/v1/getsugsku|commodity/getsugsku"'

~~enablesku~~
>pdo2 -bns group.wmcrm.iwaimai.all 'grep -E "enablesku" /home/work/odp_wmcrm/log/access_log*|grep -vE "commodity/enablesku|commodity/na/enableskuv1|crmmobileui/commodity/v1/enablesku"'

~~addskubatch~~
>pdo2 -bns group.wmcrm.iwaimai.all 'grep -E "addskubatch" /home/work/odp_wmcrm/log/access_log*'

~~updateskubatch~~
>pdo2 -bns group.wmcrm.iwaimai.all 'grep -E "updateskubatch" /home/work/odp_wmcrm/log/access_log*|grep -vE "commodity/soaupdateskubatchbysupplier|commodity/updateskubatch"'

~~getskulist~~
>pdo2 -bns group.wmcrm.iwaimai.all 'grep -E "getskulist" /home/work/odp_wmcrm/log/access_log*|grep -vE "crmmobileui/commodity/v1/getskulistbyfrontcategory|commodity/getskulist|commodity/na/getskulistbyfrontcategoryv1|commodity/na/getskulistv1|crmmobileui/commodity/v1/getskulist"'

~~updatesku~~
~~export~~
~~getsku~~

根据在中控机排查,结论为：
当前调用了goods/main/main/addshopdishlog的接口都已经迁移,或者走老的crmmobileui层（新零售部分取消了该模块）

改接口及相关上层建议删除

#### addshoplog
主要调用点:./models/service/page/account/ShopUser.php

```PHP
'updatephonebysupplier' => 'actions/account/UpdatePhoneBySupplier.php';
'updatepasswordbysupplier' => 'actions/account/UpdatePasswordBySupplier.php';
'updatepassword' => 'actions/account/UpdatePassword.php';
'updatephone' => 'actions/account/UpdatePhone.php';
```


~~updatephonebysupplier~~
>pdo2 -bns group.wmcrm.iwaimai.all 'grep -E "updatephonebysupplier" /home/work/odp_wmcrm/log/access_log* --color=auto'

~~updatepasswordbysupplier~~
>pdo2 -bns group.wmcrm.iwaimai.all 'grep -E "updatepasswordbysupplier" /home/work/odp_wmcrm/log/access_log* --color=auto'

<font color=red>updatepassword</font>
>pdo2 -bns group.wmcrm.iwaimai.all 'grep -E "updatepassword" /home/work/odp_wmcrm/log/access_log* --color=auto'

~~updatephone~~
>pdo2 -bns group.wmcrm.iwaimai.all 'grep -E "updatephone" /home/work/odp_wmcrm/log/access_log* --color=auto'

结论:除了<font color=red>updatepassword</font>接口外都已无流量,updatepasswd接口需要迁移

### 万能接口
```PHP
./models/dao/api/shop/Base.php:        $req['header']['pathinfo'] = 'goods/main/main/getlistbyconds';
./models/dao/api/shop/Base.php:        $req['header']['pathinfo'] = 'goods/main/main/getcountbyconds';
```
#### goods/main/main/getlistbyconds
调用的dao:
./models/dao/api/shop/AnnouncementLog.php
./models/dao/api/shop/Base.php

##### Base.php
继承了Base的子类
```shell
./models/dao/api/dish/Base.php:
./models/dao/api/shop/ShopBasic.php:
./models/dao/api/shop/Supplier.php:
./models/dao/api/shop/AnnouncementLog.php:
./models/dao/api/shop/ShopTakeout.php:
./models/dao/api/shop/SupplierTrade.php:
./models/dao/api/shop/DeliverRegion.php:
./models/dao/api/shop/Base.php:
```

###### Dao_Api_Dish_Base
####### Dao_Api_Dish_Dish extends Dao_Api_Dish_Base
```shell
./models/service/page/crmdata/ShopData.php:
./models/service/page/crmdata/ManagerData.php:
./models/service/page/commodity/Sku.php:
./models/service/page/dish/DeleteCategory.php:
./models/service/page/dish/Category.php:
./models/service/page/dish/Combo.php:
./models/service/page/dish/Atta.php:
./models/service/page/dish/Dish.php:
./models/service/page/dish/UpdateDishCategoryRank.php:
./models/service/page/shop/GetSelfCheckinFeed.php:
./models/service/page/decorate/Shop.php:
```

## 后续工作
### shop_user
* 历史订单迁移时间
* 
### getshopinfov1
* ~~标识上线商户来源（李京确认）~~
* 营业状态
* 历史订单迁移时间



####### Dao_Api_Dish_Gallery extends Dao_Api_Dish_Base

#工作心得
```shell
grep -v with multiple patterns
grep test somefile | grep -v -e error -e critical -e warning
grep test somefile | grep -vE '(error|critical|warning)'
grep test somefile | grep -vE 'error|critical|warning'
```


整理goods/main接口,整理了一下午,去你妈,太特么多了果断甩